-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.athlete_invites (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  program_id uuid NOT NULL,
  email text NOT NULL,
  invite_token text NOT NULL UNIQUE,
  status text NOT NULL DEFAULT 'pending'::text,
  expires_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT athlete_invites_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_invites_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT athlete_invites_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.programs(id)
);
CREATE TABLE public.athlete_scores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  athlete_id uuid NOT NULL,
  academic_score integer NOT NULL DEFAULT 0,
  performance_score integer NOT NULL DEFAULT 0,
  availability_score integer NOT NULL DEFAULT 0,
  conduct_score integer NOT NULL DEFAULT 0,
  global_overall integer NOT NULL DEFAULT 0,
  breakdown_json jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT athlete_scores_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_scores_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id)
);
CREATE TABLE public.athlete_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  stripe_customer_id text,
  stripe_subscription_id text,
  plan_code text NOT NULL,
  status text NOT NULL,
  current_period_end timestamp with time zone,
  cancel_at_period_end boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT athlete_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT athlete_subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  organization_id uuid NOT NULL,
  first_name text NOT NULL,
  last_name text NOT NULL,
  grad_year integer NOT NULL,
  event_group text NOT NULL,
  user_id uuid UNIQUE,
  is_claimed boolean NOT NULL DEFAULT false,
  school_id uuid,
  hs_school_name text,
  hs_city text,
  hs_state text,
  hs_country text,
  hs_coach_name text,
  hs_coach_email text,
  hs_coach_phone text,
  CONSTRAINT athletes_pkey PRIMARY KEY (id),
  CONSTRAINT athletes_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT athletes_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.schools(id)
);
CREATE TABLE public.memberships (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid NOT NULL,
  organization_id uuid NOT NULL,
  role USER-DEFINED NOT NULL,
  CONSTRAINT memberships_pkey PRIMARY KEY (id)
);
CREATE TABLE public.program_athlete_scores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  program_id uuid NOT NULL,
  athlete_id uuid NOT NULL,
  scoring_profile_id uuid,
  overall_for_program integer NOT NULL DEFAULT 0,
  fit_score_for_program integer,
  breakdown_json jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT program_athlete_scores_pkey PRIMARY KEY (id),
  CONSTRAINT program_athlete_scores_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.programs(id),
  CONSTRAINT program_athlete_scores_athlete_id_fkey FOREIGN KEY (athlete_id) REFERENCES public.athletes(id),
  CONSTRAINT program_athlete_scores_scoring_profile_id_fkey FOREIGN KEY (scoring_profile_id) REFERENCES public.program_scoring_profiles(id)
);
CREATE TABLE public.program_scoring_profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  program_id uuid NOT NULL,
  label text NOT NULL,
  weights_json jsonb NOT NULL,
  is_default boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT program_scoring_profiles_pkey PRIMARY KEY (id),
  CONSTRAINT program_scoring_profiles_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.programs(id)
);
CREATE TABLE public.program_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  program_id uuid NOT NULL,
  stripe_customer_id text,
  stripe_subscription_id text UNIQUE,
  plan_code text NOT NULL,
  status text NOT NULL,
  current_period_end timestamp with time zone,
  cancel_at_period_end boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT program_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT program_subscriptions_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.programs(id)
);
CREATE TABLE public.programs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  school_id uuid NOT NULL,
  name text NOT NULL,
  sport text NOT NULL,
  gender text,
  level text,
  season text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT programs_pkey PRIMARY KEY (id),
  CONSTRAINT programs_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.schools(id)
);
CREATE TABLE public.recruits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  organization_id uuid NOT NULL,
  first_name text NOT NULL,
  last_name text NOT NULL,
  grad_year integer NOT NULL,
  event_group text NOT NULL,
  status text NOT NULL,
  notes text,
  pipeline_stage text DEFAULT ''::text CHECK (pipeline_stage = ANY (ARRAY['new'::text, 'evaluating'::text, 'priority'::text, 'offer_out'::text, 'committed'::text, 'archived'::text])),
  interest_level integer DEFAULT 3 CHECK (interest_level >= 1 AND interest_level <= 5),
  probability numeric DEFAULT 0.25 CHECK (probability >= 0::numeric AND probability <= 1::numeric),
  projected_points numeric,
  last_contact_at timestamp with time zone,
  next_action_at timestamp with time zone,
  color_tag text,
  CONSTRAINT recruits_pkey PRIMARY KEY (id)
);
CREATE TABLE public.roster_athletes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  recruit_id uuid,
  first_name text NOT NULL,
  last_name text NOT NULL,
  sex text CHECK (sex = ANY (ARRAY['male'::text, 'female'::text, 'other'::text])),
  grad_year integer,
  position_group text,
  primary_event text,
  pr_seconds numeric,
  class_year text,
  scholarship_pct numeric,
  is_active boolean NOT NULL DEFAULT true,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT roster_athletes_pkey PRIMARY KEY (id),
  CONSTRAINT roster_athletes_recruit_id_fkey FOREIGN KEY (recruit_id) REFERENCES public.recruits(id)
);
CREATE TABLE public.schools (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  level text NOT NULL,
  country text,
  state text,
  city text,
  postal_code text,
  short_code text,
  external_ref text,
  is_claimed boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  primary_color text,
  secondary_color text,
  logo_url text,
  domain text,
  identity_json jsonb,
  CONSTRAINT schools_pkey PRIMARY KEY (id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  auth_id uuid NOT NULL DEFAULT gen_random_uuid(),
  email text NOT NULL,
  name text,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  user_subscription_tier USER-DEFINED,
  stripe_customer_id text,
  stripe_subscription_id text,
  user_billing_status USER-DEFINED,
  subscription_tier text,
  billing_status USER-DEFINED DEFAULT 'none'::billing_status_enum,
  ai_assistant_enabled boolean DEFAULT false,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);